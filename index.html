<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="记录...">
<meta property="og:type" content="website">
<meta property="og:title" content="Wuzhao">
<meta property="og:url" content="http://liwuzhao.com/index.html">
<meta property="og:site_name" content="Wuzhao">
<meta property="og:description" content="记录...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wuzhao">
<meta name="twitter:description" content="记录...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://liwuzhao.com/"/>





  <title>Wuzhao</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wuzhao</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/09/17/inject 方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/17/inject 方法/" itemprop="url">inject方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-17T10:26:00+08:00">
                2017-09-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>inject 方法的两种用法</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">enum.inject(init_value)&#123; <span class="params">|result,element|</span> &#125;</div><div class="line">enum.inject&#123; <span class="params">|result,element|</span> &#125;</div></pre></td></tr></table></figure>
<p>第一种，result 以init_value为初始值<br>第二种，result以element里的第一个元素为初始值</p>
<p>例子：选出数组中的偶数</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">array1= [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>].inject([]) <span class="keyword">do</span> <span class="params">|result, element|</span>  </div><div class="line">  result &lt;&lt; element.to_s <span class="keyword">if</span> element % <span class="number">2</span> == <span class="number">0</span>  </div><div class="line">  result  </div><div class="line"><span class="keyword">end</span>  </div><div class="line">p array1</div></pre></td></tr></table></figure>
<p>碰上的一个实际例子，取出所有的分类（category），并组成一个二维数组</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> &lt; ApplicationRecord</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">grouped_data</span></span></div><div class="line">    <span class="keyword">self</span>.roots.order(<span class="string">"weight desc"</span>).inject([]) <span class="keyword">do</span> <span class="params">|result, parent|</span></div><div class="line">      row = []</div><div class="line">      row &lt;&lt; parent</div><div class="line">      row &lt;&lt; parent.children.order(<span class="string">"weight desc"</span>)</div><div class="line">      result &lt;&lt; row</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>首先，<code>roots</code>方法是<code>gem &#39;ancestry&#39;</code>内置的，用于取出所有的一级分类。</p>
<p>这段代码先把<strong>每一个一级分类</strong>及其<strong>二级分类</strong>放入数组row</p>
<p>然后row放入数组result</p>
<p>最后result组成的就是一个二维数组</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/08/18/高级登录-记住我/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/18/高级登录-记住我/" itemprop="url">高级登录—记住我</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T00:26:00+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>生成随机字符串，用作记忆令牌；</li>
<li>把这个令牌存入浏览器的 cookie 中，并把过期时间设为未来的某个日期；</li>
<li>在数据库中存储令牌的摘要；</li>
<li>在浏览器的 cookie 中存储加密后的用户 ID；</li>
<li>如果 cookie 中有用户的 ID，就用这个 ID 在数据库中查找用户，并且检查 cookie 中的记忆令牌和数据库中的哈希摘要是否匹配。</li>
</ul>
<blockquote>
<p> Rails 应用经常使用 20 年后过期的 cookie，所以 Rails 提供了一个特殊的方法 permanent，用于创建这种 cookie</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cookies.permanent[<span class="symbol">:remember_token</span>] = remember_token</div></pre></td></tr></table></figure>
<blockquote>
<p>如果没有记忆令牌，攻击者一旦知道加密的 ID，就能以这个用户的身份登录。但是按照我们目前的设计方式，就算攻击者同时获得了用户 ID 和记忆令牌，至多只能维持登录状态到真正的用户退出</p>
</blockquote>
<h4 id="返回指定字符串的哈希摘要"><a href="#返回指定字符串的哈希摘要" class="headerlink" title="返回指定字符串的哈希摘要"></a>返回指定字符串的哈希摘要</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">digest</span><span class="params">(string)</span></span></div><div class="line">  cost = ActiveModel::SecurePassword.min_cost ? BCrypt::Engine::MIN_COST :</div><div class="line">    	 BCrypt::Engine.cost</div><div class="line">  BCrypt::Password.create(string, <span class="symbol">cost:</span> cost)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h4 id="验证令牌和摘要，如果指定的令牌和摘要匹配，返回-true"><a href="#验证令牌和摘要，如果指定的令牌和摘要匹配，返回-true" class="headerlink" title="验证令牌和摘要，如果指定的令牌和摘要匹配，返回 true"></a>验证令牌和摘要，如果指定的令牌和摘要匹配，返回 true</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">authenticated?</span><span class="params">(attribute, token)</span></span></div><div class="line">  digest = send(<span class="string">"<span class="subst">#&#123;attribute&#125;</span>_digest"</span>)</div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">if</span> digest.<span class="literal">nil</span>?</div><div class="line">  BCrypt::Password.new(digest).is_password?(token)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment">#使用范例</span></div><div class="line">user.authenticated?(<span class="symbol">:remember</span>, cookies[<span class="symbol">:remember_token</span>])</div></pre></td></tr></table></figure>
<p>####在持久会话中记住用户</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">remember</span><span class="params">(user)</span></span></div><div class="line">  user.remember</div><div class="line">  cookies.permanent.signed[<span class="symbol">:user_id</span>] = user.id</div><div class="line">  cookies.permanent[<span class="symbol">:remember_token</span>] = user.remember_token</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>####登录时选择是否记住<br>登录时选择<br><figure class="highlight ruby"><figcaption><span>app/views/sessions/new.html.erb```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="string">``</span><span class="string">` ruby</span></div><div class="line">&lt;%= form_for(:session, url: login_path) do |f| %&gt;</div><div class="line">  ...</div><div class="line"></div><div class="line">  &lt;%= f.label :remember_me, class: "checkbox inline" do %&gt;</div><div class="line">      &lt;%= f.check_box :remember_me %&gt;</div><div class="line">      &lt;span&gt;Remember me on this computer&lt;/span&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line"></div><div class="line">  ...</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">``` ruby</div><div class="line">def create</div><div class="line">  	...</div><div class="line">	params[:session][:remember_me] == &apos;1&apos; ? remember(user) : forget(user)</div><div class="line"> 	...</div><div class="line">end</div></pre></td></tr></table></figure>
<p>如果勾选了复选框，<code>params[:session][:remember_me]</code> 的值是 ‘1’，否则是 ‘0’</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/08/18/belongs_to关联 可支持选项/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/18/belongs_to关联 可支持选项/" itemprop="url">belongs_to关联 可支持选项</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T00:26:00+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="belongs-to关联-可支持选项"><a href="#belongs-to关联-可支持选项" class="headerlink" title="belongs_to关联 可支持选项"></a>belongs_to关联 可支持选项</h3><h4 id="autosave"><a href="#autosave" class="headerlink" title="autosave"></a>autosave</h4><p>如果把 <code>:autosave</code> 选项设为 <code>true</code>，保存父对象时，会自动保存所有子对象，并把标记为析构的子对象销毁。</p>
<h4 id="class-name"><a href="#class-name" class="headerlink" title="class_name"></a>class_name</h4><p>指定关联的模型名称</p>
<h4 id="counter-cache"><a href="#counter-cache" class="headerlink" title="counter_cache"></a>counter_cache</h4><p>提高统计所属对象数量操作的效率</p>
<p>如<code>@author.books.size</code> 会调用之前计算好的缓存数据，而不用对数据库进行计算</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> &lt; ApplicationRecord</span></div><div class="line">  belongs_to <span class="symbol">:author</span>, <span class="symbol">counter_cache:</span> <span class="literal">true</span></div><div class="line"><span class="keyword">end</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span> &lt; ApplicationRecord</span></div><div class="line">  has_many <span class="symbol">:books</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p><code>Author</code>模型中要加入<code>books_count</code>字段</p>
<h4 id="dependent"><a href="#dependent" class="headerlink" title="dependent"></a>dependent</h4><ul>
<li><code>:destroy</code>：也销毁关联的对象</li>
<li><code>:delete_all</code>：直接从数据库中删除关联的对象（不执行回调）</li>
<li><code>:nullify</code>：把外键设为 <code>NULL</code>（不执行回调）</li>
<li><code>:restrict_with_exception</code>：如果有关联的记录，抛出异常</li>
<li><code>:restrict_with_error</code>：如果有关联的对象，为属主添加一个错误</li>
</ul>
<blockquote>
<p>在 <code>belongs_to</code> 关联和 <code>has_many</code> 关联配对时，不应该设置这个选项，否则会导致数据库中出现无主记录。</p>
</blockquote>
<h4 id="foreign-key"><a href="#foreign-key" class="headerlink" title="foreign_key"></a>foreign_key</h4><p>按照约定，用来存储外键的字段名是关联名后加 <code>_id</code></p>
<p><code>:foreign_key</code> 选项可以设置要使用的外键名</p>
<h4 id="primary-key"><a href="#primary-key" class="headerlink" title="primary_key"></a>primary_key</h4><p>按照约定，Rails 假定使用表中的 <code>id</code> 列保存主键。使用 <code>:primary_key</code> 选项可以指定使用其他列。</p>
<h4 id="inverse-of"><a href="#inverse-of" class="headerlink" title="inverse_of"></a>inverse_of</h4><p><code>:inverse_of</code> 选项指定 <code>belongs_to</code> 关联另一端的 <code>has_many</code> 和 <code>has_one</code> 关联名。不能和 <code>:polymorphic</code> 选项一起使用</p>
<h4 id="polymorphic"><a href="#polymorphic" class="headerlink" title="polymorphic"></a>polymorphic</h4><p><a href="https://ruby-china.github.io/rails-guides/association_basics.html#polymorphic-associations" target="_blank" rel="external">多态关联</a></p>
<h4 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h4><p>如果把 <code>:touch</code> 选项设为 <code>true</code>，保存或销毁对象时，关联对象的 <code>updated_at</code> 或 <code>updated_on</code> 字段会自动设为当前时间</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/07/05/JD-store提取练习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/05/JD-store提取练习/" itemprop="url">JD-store提取练习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-05T00:26:00+08:00">
                2017-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="后台-amp-前台"><a href="#后台-amp-前台" class="headerlink" title="后台 &amp; 前台"></a>后台 &amp; 前台</h2><blockquote>
<p>2017.7.3</p>
<p>21:38 ~ 22:50</p>
<p>共计1小时12分钟</p>
</blockquote>
<ul>
<li>前后台的CRUD</li>
<li>限制只有管理员能进后台</li>
<li>商品要有图片</li>
</ul>
<h2 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h2><blockquote>
<p>2017.7.4<br>11:05 ~ 12:06<br>共计1小时1分</p>
</blockquote>
<ul>
<li>给用户配一辆购物车</li>
<li>加入购物车</li>
<li>清楚购物车的商品 &amp; 删除购物车商品</li>
<li>修改购买数量</li>
</ul>
<h2 id="订单"><a href="#订单" class="headerlink" title="订单"></a>订单</h2><blockquote>
<p>2017.7.4</p>
<p>23:08 ~ 23:36</p>
<p>共计28分钟</p>
</blockquote>
<ul>
<li>用户可以对购物车的商品下单</li>
<li>将购买信息保存在订单中</li>
<li>用户可以查看自己的历史订单</li>
</ul>
<h2 id="支付与寄信"><a href="#支付与寄信" class="headerlink" title="支付与寄信"></a>支付与寄信</h2><blockquote>
<p>2017.7.4</p>
<p>23:37 ~ 23:50</p>
<p>共计13分钟</p>
</blockquote>
<ul>
<li>给订单添加支付信息</li>
<li>用户可以对订单进行支付</li>
<li>支付后会寄出确认信</li>
</ul>
<h2 id="后台出货操作"><a href="#后台出货操作" class="headerlink" title="后台出货操作"></a>后台出货操作</h2><blockquote>
<p>2017.7.4</p>
<p>21:51 ~ 00:11</p>
<p>共计20分钟</p>
</blockquote>
<ul>
<li>用<code>aasm</code>对订单的状态进行切换</li>
<li>出货和取消订单后寄出确认信</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>购物车的设计很有意思，跟一般的功能有些区别</li>
</ul>
<p><strong>几个上一次做不够留心的点</strong></p>
<ul>
<li><p>寄信功能，没有用到gem，用到的gem是用来预览信件的，实际寄信功能在后面会用到SendCloud的第三方服务</p>
</li>
<li><p><code>gem &#39;aasm&#39;</code>可以对一个栏位的状态进行切换</p>
<p>预设要添加的栏位是<code>aasm_state</code>，要修改的话需要特别指定</p>
<p>简单用法可以从JD-store中迁移使用，更详细的参考<a href="http://kenny-on-rails.blogspot.com/2016/07/aasm.html" target="_blank" rel="external">aasm</a></p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/07/02/job-listing提取/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/02/job-listing提取/" itemprop="url">Job-listing提取练习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-02T22:40:00+08:00">
                2017-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><blockquote>
<p>2017.7.2</p>
<p>19：15 ~ 19：35<br>共计20分钟</p>
</blockquote>
<ul>
<li>fork专案</li>
<li>装上<code>bootstrap-sass</code> <code>simple_form</code> <code>devise</code></li>
<li>增加flash通知</li>
</ul>
<h2 id="商家故事-管理员"><a href="#商家故事-管理员" class="headerlink" title="商家故事(管理员)"></a>商家故事(管理员)</h2><blockquote>
<p>2017.7.2<br>19：58 ~ 21：32<br>共计34分钟</p>
</blockquote>
<ul>
<li>新增职缺(标题、内容、薪资下限、薪资下限、联系方式)</li>
<li>编辑、删除、隐藏职缺(在后台)</li>
<li>必须是admin才能登入后台(增加admin限制)</li>
<li>后台样式</li>
<li>在后台查看简历 &amp; 下载附件</li>
</ul>
<h2 id="用户故事-应征者"><a href="#用户故事-应征者" class="headerlink" title="用户故事(应征者)"></a>用户故事(应征者)</h2><blockquote>
<p>2017.7.2<br>21：45 ~ 22：23<br>共计38分钟</p>
</blockquote>
<ul>
<li>用户(前台)的CRUD</li>
<li>排序查看(薪资上限、薪资下限、时间)</li>
<li>提交简历</li>
<li>简历可以上传文件</li>
</ul>
<h2 id="卡住的点"><a href="#卡住的点" class="headerlink" title="卡住的点"></a>卡住的点</h2><p><strong>flash提示关闭不了</strong><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/<span class="regexp">/= require bootstrap/dropdown</span></div><div class="line">/<span class="regexp">/= require bootstrap/alert</span></div><div class="line">/<span class="regexp">/= require_tree .</span></div></pre></td></tr></table></figure></p>
<p>解法：alert要在dropdown的下面</p>
<p><strong>简历上传附件</strong><br>用到<code>carrierwave</code><br>下载附件的代码<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= link_to(<span class="string">"下载附件"</span>, resume.attachment_url) %&gt;</div></pre></td></tr></table></figure></p>
<p>应该是这支gem特定的用法</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/06/28/2017-06-28-1981284/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/28/2017-06-28-1981284/" itemprop="url">命令路由 & Patch</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-28T15:51:00+08:00">
                2017-06-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在做多步骤表单，即把表单拆成几部分去填写，用到了<strong>命名路由</strong>的写法</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">resources <span class="symbol">:events</span> <span class="keyword">do</span></div><div class="line">  resources <span class="symbol">:registrations</span> <span class="keyword">do</span></div><div class="line">    member <span class="keyword">do</span></div><div class="line">      get <span class="string">"steps/1"</span> =&gt; <span class="string">"registrations#step1"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:step1</span></div><div class="line">      patch <span class="string">"steps/1/update"</span> =&gt; <span class="string">"registrations#step1_update"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:update_step1</span></div><div class="line">      get <span class="string">"steps/2"</span> =&gt; <span class="string">"registrations#step2"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:step2</span></div><div class="line">      patch <span class="string">"steps/2/update"</span> =&gt; <span class="string">"registrations#step2_update"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:update_step2</span></div><div class="line">      get <span class="string">"steps/3"</span> =&gt; <span class="string">"registrations#step3"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:step3</span></div><div class="line">      patch <span class="string">"steps/3/update"</span> =&gt; <span class="string">"registrations#step3_update"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:update_step3</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>而通常我们的写法是</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">member <span class="keyword">do</span></div><div class="line">  get <span class="symbol">:step2</span></div><div class="line">  patch <span class="symbol">:step2_update</span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>通过Google找到了相关的资料</p>
<h2 id="命名路由"><a href="#命名路由" class="headerlink" title="命名路由"></a>命名路由</h2><p>添两段原文的解释</p>
<p>关于命名路由</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; get &apos;/meetings&apos; =&gt; &apos;events#index&apos;, :as =&gt; &quot;meetings&quot;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>其中<code>:as</code>的部份就會產生一個<code>meetings_path</code>和<code>meetings_url</code>的<em>Helpers</em>，<code>_path</code>和<code>_url</code>的差別在於前者是相對路徑，後者是絕對路徑。一般來說比較常用<code>_path</code>方法，除非像是在<em>Email</em>信件中，才必須用<code>_url</code>提供包含<em>Domain</em>的完整網址。</p>
</blockquote>
<p>关于路由系统</p>
<blockquote>
<p>不同於靜態網頁的路由是直接對應於檔案的目錄結構，一個<em>Web</em>開發框架會將路由功能納入其中，來獲得最大的彈性。也就是您可以指定任意<em>URL</em>對應到任一個<em>Controller</em>的<em>Action</em>。另一方面，我們也不在<em>Views</em>中直接寫死<em>URL</em>網址，而是透過<em>Helper</em>輔助方法根據你的路由設定來產生<em>URL</em>，這樣也可以確定該網址一定有對應的<em>Controller和Action</em>，不然就會出現<em>NoMethodError</em>找不到<em>Helper</em>方法的錯誤。</p>
</blockquote>
<p>回到前面说到的多步骤表单</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">get <span class="string">"steps/2"</span> =&gt; <span class="string">"registrations#step2"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:step2</span></div></pre></td></tr></table></figure>
<p><strong>这句就产生了一个<code>steps/2</code>的url</strong></p>
<p><code>http://localhost:3000/events/8/registrations/1560441c-5f32-416b-8501-503046d1f2ce/steps/2</code></p>
<p>这个地址是可以自定义的，比如我们改成</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">get <span class="string">"test/2"</span> =&gt; <span class="string">"registrations#step2"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:step2</span></div></pre></td></tr></table></figure>
<p>地址就变成了</p>
<p><code>http://localhost:3000/events/8/registrations/2e527daa-64a4-4fc3-b555-196939085230/test/2</code></p>
<p><strong>:as的部分就是产生对应的地址的Helpers，供我们使用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">patch &quot;steps/2/update&quot; =&gt; &quot;registrations#step2_update&quot;, :as =&gt; :update_step2</div></pre></td></tr></table></figure>
<p>输入<code>rake routes</code> 可以看到一个对应的路径是</p>
<p><code>update_step2_event_registration</code></p>
<p>如果修改成</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">patch <span class="string">"steps/2/update"</span> =&gt; <span class="string">"registrations#step2_update"</span>, <span class="symbol">:as</span> =&gt; <span class="symbol">:test_test_step2</span></div></pre></td></tr></table></figure>
<p>路径就变成了</p>
<p><code>test_test_step2_event_registration</code></p>
<p>我们调用的时候一般在后面加一个<code>_path</code></p>
<p>比如<code>update_step2_event_registration_path</code></p>
<p>参考<a href="https://ihower.tw/rails/routing.html" target="_blank" rel="external">Ruby实战圣经</a></p>
<h2 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h2><p>上面用到的是<strong>Patch</strong></p>
<p>简单来说</p>
<p>Patch 是可以用于部分更新</p>
<p>Put 是完全的替换</p>
<p>Post 用于新增</p>
<p>Rails4之后的update已经用了patch</p>
<p>参考<a href="https://ihower.tw/blog/archives/6483" target="_blank" rel="external">ihower老师的blog</a>  <a href="https://ihower.tw/rails/restful.html" target="_blank" rel="external">RESTful 應用程式</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/06/26/2017-06-26-knowledge-of-rails102-records/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/26/2017-06-26-knowledge-of-rails102-records/" itemprop="url">Rails102知识点记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-26T14:45:00+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Rails102知识点记录"><a href="#Rails102知识点记录" class="headerlink" title="Rails102知识点记录"></a>Rails102知识点记录</h2><p>读了Rails102关于Model的第一部分，学到几个新的知识点</p>
<ul>
<li><strong>includes</strong>  合理使用可以提高资料库搜索的效率</li>
<li><strong>counter_cache</strong> 在做关联性资料库计算时的一种方法，可以提高效率</li>
<li><strong>STL</strong> 继承的model可以拥有父类的表格栏位的方法</li>
<li><strong>Polymorphic Association</strong>可以让两个不同的model同时has_many一个model的方法，比如两个model的都需要留言</li>
</ul>
<p>具体内容可以直接在<a href="https://www.gitbook.com/book/rocodev/rails-102/details" target="_blank" rel="external">书中</a>找到</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/06/26/2017-06-26-1976984/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/26/2017-06-26-1976984/" itemprop="url">使用Form时区分不同的动作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-26T14:43:00+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="区分form的操作"><a href="#区分form的操作" class="headerlink" title="区分form的操作"></a>区分form的操作</h2><p>一个 form 的送出 URL 位置是固定的，会进到同一个 action，并且form里面不能再包form</p>
<p>我在商店大赛中使用form去实作<strong>加入购物车</strong>后，当时也不会区分<strong>立即购买</strong>的动作</p>
<p>原来在执行submit的时候，它的<strong>文字也会变成参数送出</strong>，这样就可以通过判断不同的按钮的参数执行不同的动作了</p>
<p>以<strong>加入购物车</strong>和<strong>立即购买</strong>为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;%= form_tag add_to_cart_product_path(@product), :method =&gt; :post do %&gt;</div><div class="line">  ...</div><div class="line">  &lt;%= submit_tag &quot;加入购物车&quot;, :class =&gt; &quot;btn btn-lg a1&quot; %&gt;</div><div class="line">  &lt;%= submit_tag &quot;立即购买&quot;, class: &quot;btn btn-lg a2&quot;%&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>观察HTML源码</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;input type="submit" name="commit" value="加入购物车" class="btn btn-lg a1" data-disable-with="加入购物车"&gt;</div><div class="line">&lt;input type="submit" name="commit" value="加入购物车" class="btn btn-lg a1" data-disable-with="加入购物车"&gt;</div></pre></td></tr></table></figure>
<p>按钮的值value也会送出，送出的参数名称叫做commit</p>
<p>所以我们在controller中就可以判断用户是执行了哪个按钮</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">def add_to_cart</div><div class="line">  	...</div><div class="line">    if params[:commit] == "加入购物车"</div><div class="line">      ....</div><div class="line">      //这里是加入购物车的动作</div><div class="line">    elsif params[:commit] == "立即购买"</div><div class="line">      ....</div><div class="line">      //这里是立即购买的动作</div><div class="line">    end</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/06/21/2017-06-21-orid-620-implements-ajax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/21/2017-06-21-orid-620-implements-ajax/" itemprop="url">ORID 6.20 实作Ajax</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-21T03:16:00+08:00">
                2017-06-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Objective</p>
<ul>
<li>上课</li>
<li>实作Ajax</li>
</ul>
<p>##Reflective</p>
<p>##Interpretive<br>今天做的是在购物车页面+ -数量时改变内容不会刷新页面<br>根据教程，要合理地利用<code>partial</code>，在动作发生后把整个<code>partial</code>替换</p>
<figure class="highlight"><figcaption><span>cart/index</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;div id="change" class="col-xs-12 col-md-8 padding-bottom-2x"&gt;</div><div class="line"> &lt;%= render :partial =&gt; "cart_data" %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p><code>cart_data</code>就是关于购物车中每件商品的具体信息</p>
<p>要做的action是<code>add_quantity</code>和<code>remove_quantity</code></p>
<p>在原来的专案中，这两个action是在<code>cart_items_controller.rb</code>中，因为是在cart的页面刷新，所以我把它放在<code>carts_controller.rb</code> 并且要修改对应的routes</p>
<p>两个action的link要加上<code>remote: true</code></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;%= link_to(<span class="string">"-"</span>, remove_quantity_cart_path(cart_item.product_id), <span class="symbol">remote:</span> <span class="literal">true</span>, <span class="symbol">method:</span> <span class="symbol">:post</span>) %&gt;</div><div class="line">&lt;%= link_to(<span class="string">"+"</span>, add_quantity_cart_path(cart_item.product_id), <span class="symbol">remote:</span> <span class="literal">true</span>, <span class="symbol">method:</span> <span class="symbol">:post</span>) %&gt;</div></pre></td></tr></table></figure>
<p>然后新建<code>add_quantity.js.erb</code></p>
<figure class="highlight ruby"><figcaption><span>add_quantity.js.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">str = <span class="string">"&lt;%=j render :partial =&gt; "</span>cart_data<span class="string">" %&gt;"</span>;</div><div class="line">$(<span class="string">"#change"</span>).html(str);</div></pre></td></tr></table></figure>
<p>把<code>cart_data</code>的内容替换掉</p>
<p><code>add_quantity</code>会找到他对应的名字的js文件，只需要去掉原来的<code>redirect_to</code><br>而<code>remove_quantity</code>因为是使用同样的效果，所以使用<code>render</code><br><figure class="highlight ruby"><figcaption><span>carts_controller.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_quantity</span></span></div><div class="line">  @cart_item = current_cart.cart_items.find_by_product_id(params[<span class="symbol">:id</span>])</div><div class="line">  <span class="keyword">if</span> @cart_item.quantity &lt; @cart_item.product.quantity</div><div class="line">       @cart_item.quantity += <span class="number">1</span></div><div class="line">       @cart_item.save</div><div class="line">      -  redirect_to carts_path</div><div class="line">  <span class="keyword">elsif</span> @cart_item.quantity == @cart_item.product.quantity</div><div class="line">      -  redirect_to carts_path, <span class="symbol">alert:</span> <span class="string">"库存不足！"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_quantity</span></span></div><div class="line">  @cart_item = current_cart.cart_items.find_by_product_id(params[<span class="symbol">:id</span>])</div><div class="line">  <span class="keyword">if</span> @cart_item.quantity &gt; <span class="number">0</span></div><div class="line">       @cart_item.quantity -= <span class="number">1</span></div><div class="line">       @cart_item.save</div><div class="line">    -  redirect_to carts_path</div><div class="line">    +  render <span class="string">"add_quantity"</span></div><div class="line">  <span class="keyword">elsif</span> @cart_item.quantity == <span class="number">0</span></div><div class="line">    -  redirect_to carts_path</div><div class="line">    +  render <span class="string">"add_quantity"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<p>还有要变化的是总价</p>
<figure class="highlight"><figcaption><span>cart/index.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;h4 id="change-total-price" class="amount"&gt;¥ &lt;%= render_cart_total_price(current_cart)%&gt;&lt;/h4&gt;</div></pre></td></tr></table></figure>
<p>要给他不同的ID</p>
<figure class="highlight ruby"><figcaption><span>add_quantity.js.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">+ $(<span class="string">"#change-total-price"</span>).html(<span class="string">"¥ &lt;%= render_cart_total_price(current_cart)%&gt;"</span>);</div></pre></td></tr></table></figure>
<p>把总价替换一下</p>
<p>效果如下<br><img src="http://ww3.sinaimg.cn/large/006tNc79ly1fgsngumm7qg312k0k0ju1.gif" alt=""></p>
<p>加入购物车的action也大同小异，但是这样的话无法用<strong>flash提示的功能</strong>，目前还没找到办法</p>
<p>##Decisional<br>还可以</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://liwuzhao.com/2017/06/19/2017-06-19-orid-619/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuzhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/wuzhao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuzhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/19/2017-06-19-orid-619/" itemprop="url">ORID 6.19</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-19T15:06:00+08:00">
                2017-06-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Objective"><a href="#Objective" class="headerlink" title="Objective"></a>Objective</h2><ul>
<li>期末论文</li>
<li>ajax的一部分教程</li>
<li>直播</li>
<li>自测</li>
</ul>
<h2 id="Interpretive"><a href="#Interpretive" class="headerlink" title="Interpretive"></a>Interpretive</h2><ul>
<li>关于<a href="http://lazybios.com/2015/11/let-talk-about-iteration-in-ruby/" target="_blank" rel="external">Ruby的集合遍历方法</a></li>
<li>用ajax改进了一下<strong>加入购物车</strong></li>
</ul>
<h2 id="Decisional"><a href="#Decisional" class="headerlink" title="Decisional"></a>Decisional</h2><p>自测+看了一下面试题，发现要学的实在太多，切忌焦虑，要一步一步来</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/wuzhao.jpg"
               alt="wuzhao" />
          <p class="site-author-name" itemprop="name">wuzhao</p>
           
              <p class="site-description motion-element" itemprop="description">记录...</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">110</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuzhao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
